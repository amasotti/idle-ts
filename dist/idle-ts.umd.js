(function(i,e){typeof exports=="object"&&typeof module!="undefined"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(i=typeof globalThis!="undefined"?globalThis:i||self,e(i["idle-ts"]={}))})(this,function(i){"use strict";var r=Object.defineProperty;var a=(i,e,l)=>e in i?r(i,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[e]=l;var s=(i,e,l)=>(a(i,typeof e!="symbol"?e+"":e,l),l);const e=(d,t,n)=>{t.forEach(o=>{d.addEventListener(o,n)})},l=(d,t,n)=>{t.forEach(o=>{d.removeEventListener(o,n)})};class h{constructor(t){s(this,"defaults");s(this,"settings");s(this,"visibilityEvents",["visibilitychange","webkitvisibilitychange","mozvisibilitychange","msvisibilitychange"]);s(this,"idle",!1);s(this,"visible",!0);s(this,"clearTimeout");s(this,"stopListener");s(this,"idlenessEventsHandler");s(this,"visibilityEventsHandler");s(this,"throwOnBadKey",(t,n)=>{t.forEach(function(o){if(!n.includes(o))throw`set: Unknown key ${o}`})});this.defaults={idle:1e4,events:["mousemove","keydown","mousedown","touchstart"],onIdle:()=>{},onActive:()=>{},onHide:()=>{},onShow:()=>{},keepTracking:!0,startAtIdle:!1,recurIdleCall:!1},this.throwOnBadKey(Object.keys(t),Object.keys(this.defaults)),this.settings=Object.assign({},this.defaults,t),this.clearTimeout=null,this.reset(),this.stopListener=()=>{this.stop()},this.idlenessEventsHandler=()=>{this.idle&&(this.idle=!1,this.settings.onActive()&&this.settings.onActive().call()),this.resetTimeout()},this.visibilityEventsHandler=()=>{document.visibilityState==="hidden"?(this.visible=!1,this.settings.onHide()&&this.settings.onHide().call()):(this.visible=!0,this.settings.onShow()&&this.settings.onShow().call())}}resetTimeout(t=this.settings.keepTracking){this.clearTimeout&&(this.clearTimeout(),this.clearTimeout=null),t&&this.timeout()}timeout(){let t=this.settings.recurIdleCall?{set:setInterval.bind(window),clear:clearInterval.bind(window)}:{set:setTimeout.bind(window),clear:clearTimeout.bind(window)},n=t.set(()=>{this.idle=!0,this.settings.onIdle()&&this.settings.onIdle().call()},this.settings.idle);this.clearTimeout=()=>{t.clear(n)}}start(){return window.addEventListener("idle:stop",this.stopListener),this.timeout(),e(window,this.settings.events,this.idlenessEventsHandler),(this.settings.onShow||this.settings.onHide)&&e(window,this.visibilityEvents,this.visibilityEventsHandler),this}stop(){return window.removeEventListener("idle:stop",this.stopListener),l(window,this.settings.events,this.idlenessEventsHandler),this.resetTimeout(!1),(this.settings.onShow||this.settings.onHide)&&l(window,this.visibilityEvents,this.visibilityEventsHandler),this}reset({idle:t=this.settings.startAtIdle,visible:n=!this.settings.startAtIdle}={}){return this.idle=t,this.visible=n,this}set(t){this.throwOnBadKey(Object.keys(t),Object.keys(this.defaults)),this.settings=Object.assign(this.settings,t)}}i.IdleTs=h,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
